<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Parking NearU</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
:root{--primary:#1976d2;--card:#fff;--bg:#f4f6f9;}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Segoe UI,Arial,sans-serif;background:var(--bg);}
.screen{display:none;width:100%;height:100%;}
.active{display:flex;justify-content:center;align-items:center;}
#splashScreen{flex-direction:column;background:linear-gradient(135deg,var(--primary),#42a5f5);color:#fff;}
.logo{width:120px;margin-bottom:12px}
.card{background:var(--card);border-radius:12px;padding:20px;width:100%;max-width:420px;box-shadow:0 6px 20px rgba(0,0,0,0.12)}
.input{width:100%;padding:12px 14px;margin:6px 0;border-radius:10px;border:1px solid #ddd;font-size:15px}
button{padding:10px;border-radius:10px;border:none;background:var(--primary);color:#fff;font-weight:600;cursor:pointer}
button.small-btn{padding:8px 12px;font-size:14px;width:auto}
#homeScreen{display:flex;flex-direction:column;height:100%;position:relative;}
.topbar{height:56px;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 12px;box-shadow:0 2px 6px rgba(0,0,0,0.12)}
.leftGroup{display:flex;align-items:center;gap:12px}
.profileBtn{display:flex;align-items:center;gap:8px;cursor:pointer}
.profileAvatar{width:36px;height:36px;border-radius:50%;background:#fff;color:var(--primary);display:flex;align-items:center;justify-content:center;font-weight:700}
#searchRow{display:flex;gap:8px;padding:8px;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
#searchRow input{flex:1}
#map{flex:1;width:100%;min-height:360px}
#seedBtn, #adminPanelBtn{display:none;margin:10px;padding:8px 12px;background:#4caf50;color:#fff;border:none;border-radius:8px;cursor:pointer}
/* Booking Modal */
#bookingModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:999;}
#bookingContent{background:#fff;border-radius:12px;padding:20px;width:90%;max-width:400px;}
/* Profile Panel */
#profilePanel{display:none;position:absolute;top:56px;right:12px;background:#fff;padding:12px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.2);z-index:999;width:250px;}
/* Booking History */
#bookingHistoryPanel{display:none;position:absolute;top:56px;left:12px;background:#fff;padding:12px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.2);z-index:999;width:300px;max-height:400px;overflow-y:auto;}
/* Admin Modal */
#adminModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:999;}
#adminModalContent{background:#fff;border-radius:12px;padding:20px;width:90%;max-width:400px;}
/* Notifications */
.notification{position:fixed;bottom:20px;right:20px;background:#1976d2;color:#fff;padding:12px 16px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.2);z-index:1000;}
</style>
</head>
<body>

<!-- Splash -->
<div id="splashScreen" class="screen active">
<img src="JU_ENTERPRISE_LOGO.png" class="logo" alt="logo">
<h2>Parking NearU</h2>
</div>

<!-- Login -->
<div id="loginScreen" class="screen">
<div class="card">
<h2>Login</h2>
<input id="loginId" class="input" type="text" placeholder="Email">
<input id="loginPass" class="input" type="password" placeholder="Password">
<button id="btnLogin">Login</button>
<p><a href="#" id="goSignup">Create account</a></p>
</div>
</div>

<!-- Signup -->
<div id="signupScreen" class="screen">
<div class="card">
<h2>Create Account</h2>
<input id="signupEmail" class="input" type="email" placeholder="Email">
<input id="signupPass" class="input" type="password" placeholder="Password">
<input id="signupConfirm" class="input" type="password" placeholder="Confirm Password">
<button id="btnSignup">Register</button>
<p>Already have an account? <a href="#" id="goLogin">Login</a></p>
</div>
</div>

<!-- Verify -->
<div id="verifyScreen" class="screen">
<div class="card">
<h2>Verify Email</h2>
<p>Check your inbox for the verification link. After verifying, click "Check".</p>
<button id="btnResend">Resend</button>
<button id="btnCheckStatus" class="small-btn">Check</button>
<button id="btnLogoutVerify" class="small-btn">Logout</button>
</div>
</div>

<!-- Home -->
<div id="homeScreen" class="screen">
<div class="topbar">
<div class="leftGroup">
<div id="profileBtn" class="profileBtn" title="Profile">
<div id="profileAvatar" class="profileAvatar">U</div>
<div id="brandText">Parking NearU</div>
</div>
</div>
<button id="btnLogout" class="small-btn">Logout</button>
</div>

<div id="searchRow">
<input id="fromInput" class="input" placeholder="Your location">
<input id="toInput" class="input" placeholder="Destination">
<button id="btnSearch" class="small-btn">Go</button>
<button id="btnLocate" class="small-btn">üìç</button>
<button id="btnToggle" class="small-btn">üó∫Ô∏è</button>
</div>

<button id="adminPanelBtn">Admin Panel</button>
<button id="seedBtn">Seed Firestore Data</button>

<div id="map"></div>

<!-- Profile Panel -->
<div id="profilePanel">
<p><b>Email:</b> <span id="profileEmail"></span></p>
<p><b>Verified:</b> <span id="profileVerified"></span></p>
<button id="btnCloseProfile" class="small-btn">Close</button>
</div>

<!-- Booking History Panel -->
<div id="bookingHistoryPanel">
<h4>My Bookings</h4>
<div id="bookingList"></div>
<button id="btnCloseHistory" class="small-btn">Close</button>
</div>

<!-- Booking Modal -->
<div id="bookingModal">
<div id="bookingContent">
<h3>Book Parking Spot</h3>
<p id="spotName"></p>
<input id="vehicleNumber" class="input" placeholder="Vehicle Number">
<div id="vehicleDetails"></div>
<input id="parkingTime" class="input" type="number" placeholder="Hours">
<input id="mobileNumber" class="input" type="tel" placeholder="Mobile Number">
<button id="confirmBooking">Confirm Booking</button>
<button onclick="document.getElementById('bookingModal').style.display='none'">Cancel</button>
</div>
</div>

<!-- Admin Modal -->
<div id="adminModal">
<div id="adminModalContent">
<h3>Add Parking Spot</h3>
<input id="adminSpotName" class="input" placeholder="Spot Name">
<input id="adminLat" class="input" type="number" placeholder="Latitude">
<input id="adminLng" class="input" type="number" placeholder="Longitude">
<input id="adminCapacity" class="input" type="number" placeholder="Capacity">
<input id="adminAvailable" class="input" type="number" placeholder="Available Spots">
<button id="btnAddSpot">Add Spot</button>
<button onclick="document.getElementById('adminModal').style.display='none'">Cancel</button>
</div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, reload } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFirestore, collection, doc, addDoc, getDocs, getDoc, query, where, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig={ apiKey:"AIzaSyDm9R0kXulN2wKUqoes0U5HiQkc6OukWJw", authDomain:"parking-nearu.firebaseapp.com", projectId:"parking-nearu" };
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

// DOM
const splash=document.getElementById('splashScreen'), loginScreen=document.getElementById('loginScreen'), signupScreen=document.getElementById('signupScreen'), verifyScreen=document.getElementById('verifyScreen'), homeScreen=document.getElementById('homeScreen');
const loginId=document.getElementById('loginId'), loginPass=document.getElementById('loginPass'), btnLogin=document.getElementById('btnLogin');
const signupEmail=document.getElementById('signupEmail'), signupPass=document.getElementById('signupPass'), signupConfirm=document.getElementById('signupConfirm'), btnSignup=document.getElementById('btnSignup');
const goSignup=document.getElementById('goSignup'), goLogin=document.getElementById('goLogin');

let currentUser=null;

// Auth state
onAuthStateChanged(auth, async(user)=>{
    currentUser=user;
    if(!user){ switchScreen(loginScreen); }
    else if(!user.emailVerified){ switchScreen(verifyScreen); }
    else{ switchScreen(homeScreen); initHome(); }
});

// Login
btnLogin.onclick=async()=>{
    try{
        const cred=await signInWithEmailAndPassword(auth, loginId.value, loginPass.value);
        if(!cred.user.emailVerified) switchScreen(verifyScreen);
        else switchScreen(homeScreen);
    }catch(e){ alert(e.message); }
};

// Signup
btnSignup.onclick=async()=>{
    if(signupPass.value!==signupConfirm.value){ alert("Passwords do not match"); return; }
    try{
        const cred=await createUserWithEmailAndPassword(auth, signupEmail.value, signupPass.value);
        await sendEmailVerification(cred.user);
        alert("Verification email sent"); switchScreen(verifyScreen);
    }catch(e){ alert(e.message); }
};

// Switch links
goSignup.onclick=(e)=>{ e.preventDefault(); switchScreen(signupScreen); };
goLogin.onclick=(e)=>{ e.preventDefault(); switchScreen(loginScreen); };

// Splash
setTimeout(()=>{ switchScreen(loginScreen); },1000);

// Function to initialize home features (map, bookings, admin, profile, etc.)
function initHome(){
    // ... We will fully integrate map, admin panel, booking modal, notifications next
}
</script>
</body>
</html>
